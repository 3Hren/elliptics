#!/usr/bin/make -f

include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/cmake.mk
include /usr/share/cdbs/1/class/python-module.mk

DEB_CMAKE_EXTRA_FLAGS := -DCMAKE_BUILD_TYPE=RelWithDebInfo

DEB_DH_STRIP_ARGS := --dbg-package=elliptics-dbg
DEB_DH_MAKESHLIBS_ARGS_elliptics := -V "elliptics (>= $(shell head -n1 debian/changelog |  sed -e 's/.*[(]//' | sed -e 's/[)].*//' | tr -d '\n' | cut -d . -f 1-3))"
DEB_DH_MAKESHLIBS_ARGS_elliptics-client := -V "elliptics-client (>= $(shell head -n1 debian/changelog |  sed -e 's/.*[(]//' | sed -e 's/[)].*//' | tr -d '\n' | cut -d . -f 1-3))"
DEB_COMPRESS_EXCLUDE := .conf

DEB_PYTHON_MODULE_PACKAGES := elliptics-client
DEB_PYTHON_SYSTEM := pycentral

DEB_PYTHON_SETUP_CMD = $(DEB_BUILDDIR)/bindings/python/setup.py
DEB_PYTHON_BUILD_ARGS = --build-base="$(DEB_BUILDDIR)/bindings/python"
DEB_PYTHON_INSTALL_ARGS_ALL = --no-compile --root=
include /usr/share/cdbs/1/class/python-distutils.mk

binary-install/elliptics-client::
	cp bindings/python/*.py $(DEB_BUILDDIR)/bindings/python/

binary-post-install/elliptics-client::
	rm debian/elliptics-client/usr/bin/dnet_ioserv
